dist: xenial
before_install:
- bash install/helm_kubeval_install.sh
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBECTL_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: v4HiKLDvB5rKyPOX5BvaFyPCrFn91kJJrMtYwvWjyyTx1IWUtijjrB5CDqW3DAATamvwGzkd+Ztkkq1hSuvcTatRKYsjFkWcMTyGWUkADAtxxtaA7y1JXYGS4izL4JSLHQU2hJxheoYLRO3HXa4TgCawuz9Ff71vwSo4NTxP60Vn/oiVS4aiJU8jXaEYgMDrpdcvlfyWHsoyf1+b2t6sTSe7y8eqN5i+x4tbI3NQyRuOv9HNncR6WCba7xJsUo3LozMQbv33iuTBlBXdYuNOCie5lh6RL4fd45d4ni6xon/SAbHAQJAQmAKMYLyoqZGWn3t8A3DIhlc08oxxVxMqKzqInUBJQjO0HSzOJna51De7u2Z17GcPTJnbIxJKzxkPlHGFcunzz1P06WPKa+p73UM20GKT4W4i1zsqveBX9WNpdEHzembYYh9vt7kqUcZzmeGktudd/wErJn42tsUMpZ7nYmn6G6CRWBfLpVebt0Zg9F9h6KvgKj7+QA3QH2R/F8aDkbEymlG1u/dS4S6mrSxHdYN5mqyQiSBEY1b+rMB4o9YJLGjxzGISrNAOfQcx43NXDwMHWpduMAK+L9+BfczWWp94RF5159F2lraeARw6HTK/Cwg/YCsXGxkhO3xo36+DMvpgfu1A+d1nyOdl8laIQ61UqOxCL245pcVsQu4=
