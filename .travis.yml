dist: xenial
before_install:
- bash install/helm_kubeval_install.sh
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- bash scripts/kubeval_validate_manifest.sh
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: pmqktoN1d3it6Bhk0UWxwCM3WvM0aoidOuOmqNHME+qY0XY9ctsUjsKV5MtRfWMOTmyc7yUp0wHA3VVmZdRPXduEAVUgc0fudaqceGmrF2qGjmyMzAisEhcgvvYouF2uNtI1Hcg2t00OWl3TCqOOvFSK8ZMfeV1LkuZu139YYWJrciup3Bq8N8sAgJ5rUtmF/dAsx8SR6cRaZBo8rubPzsXdqY8fxwPvSzTHrKtS2SoBKS8J7VRTWTM7122huN/iRLpaJJUv96JlKdQKOxW2AAIWcxTYsphQmEXSghMh9sNdZ+DczncERVmJUAprHdAHf1B2GiCvpumfJLjJXSiPVYX8qEwGJZknMwI+3f1L+GUsLj+xy3mSMk6ZOPwWbMUBZow6Rv2NyTx3T/UBLk/LbMs5ScOhsv/6H5mPYDbhTnXQ/mf6rPKBrhvRUItTOUUlFFxhdh7z6/tc20oEiTB0VfOV6C4KwpKcevmLxRoccuCfYmnlPQ51i6bt3UpP3XUczkVR7CnCry4ysDgIB9y45XojVzhC9pJjpVZSqLY/0FJI6nairihs4ORNymuHZMmLIlICVKkR69mRRXaNcJuhKZiw8WL6YgLOruj6jVZYHvGSz36AjcC3qwUfna8NuBZBentm+6X6eeOUkhIbSXEEICNVnO/Unlu/xluT7LurRHE=
