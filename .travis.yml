dist: xenial
before_install:
- bash install/helm_kubeval_install.sh
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBECTL_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: oRFdPQoTyO61+Z3E43ryNx64KwlP4ChgzSzIqg9OuyBle6p/RVvRctKeoVVp9uPKrLhFOyLSJpeIXnbvfZFl1L2xZ2WY1Tui8OUZ0tTEZZlaMG22NxQrX78zLm1Nj0QsHtmpWH6C+Pl+6M4zxx0PMRA2+RsGnO2E395oYYn2skElN+9OpB15LUOHjHYXpUZHomNielFbwGNHaaP42rZk4HMWA12+A2Ug6eT/XqsDt/UHHhzMKRwn1pxv+m9/JslnueJFRsAD1Duw7sRBleTpBpiGZYjGOdRumVSFaZxkqyAYQJ/RE/B1I6MPU0tZQRVDQJEcZWru9TzrJqzfiZWHRv6vBnUqX/L4lGiz76kJnsFZPKt0JlknDZAE6woCX+SURFfLaEHAVLB/wXAEIvdIYqYhmuv5UAd9uhuViVLAB44gwfbHV5a1a0WFrukLWDMPmaKkYNNvV7O8mGTaaQYks/u6ryR5h6guuVyPBeFs+TgparopYv4zoNRs6e2Y1J6iN2XlJcPbRxwHs25Uh8yZ8bGCCYz7TnxIcpb8DRYZ3cB+65L8dzuoc10RB5Uv3P+g0sFapz/J3/VoB2MVg9yp/jhYcjzo79XoMKRv356Q2FD0YtR+VLFNM7zX3VUO9MPWNiV+KLLYaYztwOor4Oot5Kv9ZQxHuiDcN6ZD/K7xz7w=
