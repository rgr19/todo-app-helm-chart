dist: trusty
sudo: false
before_install:
- wget https://kubernetes-helm.storage.googleapis.com/helm-v2.13.1-linux-amd64.tar.gz
- tar xzvf helm-v2.13.1-linux-amd64.tar.gz
- mv linux-amd64/helm helm
- chmod u+x helm
- wget https://github.com/garethr/kubeval/releases/download/0.10.0/kubeval-linux-amd64.tar.gz
- tar xzvf kubeval-linux-amd64.tar.gz
- chmod u+x kubeval
- mv helm kubeval /home/travis/bin/
- helm init -c
env:
  matrix:
  - KUBERNETES_VERSION="1.10.9"
  global:
    secure: FTWmhOcoOU5D7QwXiPz17oV92M0psbso5vmwmVG1BoRYuxh1QQUaEG40MWQkhzYVqWeS769GBdavGbAxDTEMnEWia9Fv1v48OVOTdhi06M2UE4SbFtEeXpbN3t64tVBOOviHdtUo6qYc9u5g8NvzCV5pgvh7UCBKwdzyN70VRoWeAy47pT3lFKP6/cUoFwJbivUB4aZbXVEjbw1+RcpaJgd2qzgujhIxY+haVkt3HLRDHD2JeG/or0GxupKP11EiqteQeJ4MCc33/Q1T5ucp6zjnGhQOv4MGPJHpWtdIGefWL2RI1EvAg3852oeoMxLNh+SgqFdneoAUEhHk70gUCgXOpfwXkNsRXizOyUdKSS4pYyZRX1z5LLZk2N407r8SZtgsV+iEzErwh73ESckBHy+H/2TzVviRRZIY3yz1g5aHYJvyMasN8fLMd/xrJXUh1Ricbm7nnvuUrn253sNggVF/stOlorq+vmBCNvBZWjMRsc5mtUqyCFTSZwGfejAvOvrV+3yDbUMOs5dedyjnJ1Y8u6qJCF114C8MYpG446JCdvx5jXoCDdROh6G7MzcA/q3D2Wp3o+hDTccYpDIlowo0/6jfPDpezqw2CVDoVaAkClvNx13Mw4/nlwj19sRDWt7tr8A2j7xRa5FIy0DQGubHmDs+MIVoxQ2GTQzcwrw=
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBERNETES_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
