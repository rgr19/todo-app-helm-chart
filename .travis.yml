dist: trusty
sudo: false
before_install:
- wget https://kubernetes-helm.storage.googleapis.com/helm-v2.13.1-linux-amd64.tar.gz
- tar xzvf helm-v2.13.1-linux-amd64.tar.gz
- mv linux-amd64/helm helm
- chmod u+x helm
- wget https://github.com/garethr/kubeval/releases/download/0.10.0/kubeval-linux-amd64.tar.gz
- tar xzvf kubeval-linux-amd64.tar.gz
- chmod u+x kubeval
- mv helm kubeval /home/travis/bin/
- helm init -c
env:
  matrix:
  - KUBERNETES_VERSION="1.10.9"
  global:
    secure: MU/Lwphf0BvHySOkWTo6N1JTlCDKkJ2cnbP10TfaFSVo1uA1p8Jqr6i7lVWhJFdGdpmAdhrXEItdh7ZJK8QI6vMmHVMRuUw4x0d1FgDDv+kn//QcNPqqH70Ve3dlSsh4JY2rskgWl0TVSZWsdAeLra+5ag7JQ7lDiFZn2pahfewt6BPJZJQo9VaSLy0bEtJ/QuefInuTNojgCmYUiuK/deG76740e6V1vZYp9TvNg2DurXt84tm2Qam+6oN836N1Ew+m3WuDQXolVyD9VeKJdOyMHPAlGoQpz9JC6A8veH0MDt6xxPbk3B7B3yPxXYzY+tNVUVlec9gaW0fIhTgKJ7zXppwVkFFZYqFQsbmvBVqIL07cmck8lTVeEERxbWg4vGaQwhFHJB4QFmPh9BJfujrdT1/EsNgy8LYv1PkXaURSdCraQgerw4q1VjpSwKGxPzLhMRsqi1eR/f8ci1ySNZzTeCvjSbqjWolIkrvXOBASGiFpuvnDKP5nZGKcVicite6NE+sCmOrd30/VMK9J5YpVZD/j6SJPPmKW4hHln+xzq1XUxb+YEEeaR9M1eUvl4SE2hmtoVm6v4FCyZlSCIQS1/e1xXY/2yu6QynryWWJCHR7+sh3RrtgFb6kQEkaTuOzuEqK0LrjN6c8fkq8XsxPgHZvBvYgVRUcA6AP8cVk=
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBERNETES_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
