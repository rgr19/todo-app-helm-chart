dist: trusty
sudo: false
before_install:
- wget https://kubernetes-helm.storage.googleapis.com/helm-v2.13.1-linux-amd64.tar.gz
- tar xzvf helm-v2.13.1-linux-amd64.tar.gz
- mv linux-amd64/helm helm
- chmod u+x helm
- wget https://github.com/garethr/kubeval/releases/download/0.10.0/kubeval-linux-amd64.tar.gz
- tar xzvf kubeval-linux-amd64.tar.gz
- chmod u+x kubeval
- mv helm kubeval /home/travis/bin/
- helm init -c
env:
  matrix:
  - KUBERNETES_VERSION="1.10.9"
  global:
    secure: MdZdFh5+5muiGjBirfxYWi+9JXs7HdCYyxfBKkFocpHCfLSsy5tcDFpe2MdFAUQgCAMm6vC9gYnMUOWYIA5sm908USgslLy+Suxz2Pfm+EOMBUOUp7An3jPH2kVoL2NGAJGY7DYP6t/6cPGpJ6sxghBLpWyUwNHiFA433MSTrLgRKBTso1XcJGCLq50zJJ7tJqhtPKnwTv1zPe14XFAd2ClWSzTB1OzIAStkd2Alm6YX7WB6WkolTtNYg5KxgeBjb/DP9vGn2Hw6SAvbkNrdgA1RECmD+0vyF8WilONsTS6FWsZZDkJLdH2Um8n8ht/Vf/AU3X5yAV/jjVOK+My6aWUyXCvbCgzSuBP0j17YGBDWARUpfcKGaMakYFx6NWkLmk/XVXhy7ZMFIidqKEoZPqt1iJl5GbH4RAyT8AsvapQwDSmz2Kht7ZKZwtM13+9LAgo4umV1KnMhWK1dM4MsU04bBZN6RUCw2veJ6YSZgE1x9XbhTmN1wxTJaubjpSBy+5P/UP1pQ5b/iX8bbhRvuapMBS1uHeeP+JFqgq3Uj1D8Gkh7nul78t2gKlcTsa8FuVDCLA2/rsWpQkC0JhNF8NChWYfZeTRJQe44CFaNLsTfnR9EWMeWQzYBsBT9K143An3TqEJ4VjZJc2fXsAUH3pH38bAMmueC0UKitii3q/Q=
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBERNETES_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
