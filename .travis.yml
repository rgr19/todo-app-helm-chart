dist: trusty
sudo: false
before_install:
- wget https://kubernetes-helm.storage.googleapis.com/helm-v2.13.1-linux-amd64.tar.gz
- tar xzvf helm-v2.13.1-linux-amd64.tar.gz
- mv linux-amd64/helm helm
- chmod u+x helm
- wget https://github.com/garethr/kubeval/releases/download/0.10.0/kubeval-linux-amd64.tar.gz
- tar xzvf kubeval-linux-amd64.tar.gz
- chmod u+x kubeval
- mv helm kubeval /home/travis/bin/
- helm init -c
env:
  matrix:
  - KUBERNETES_VERSION="1.10.9"
  global:
    secure: Bj/wNKxzuZ9D4AxaPNXZHAKaROvVYeiWIIlBYWnLMHOVTwmUO2p5sYFiw2OvwD44AJZQTgvHvYUZSXkGx5wkoWc8ZvMfe0J3QnCVulppeeTivuZtRvXJgnZkj4nIaIjyLAhIG+5Ww5bdpJAsfO2O0j3Pqk4C3SaPaOAQvUM8U7Qk77+xwEPBrCqlC9MnBY/r2SVmX4EaTtYFRcJHYSn1JUb6vKzC50vMdZsRx5pQEQkGZy3o7SU+x8REPlFL3rwND5YdG0R4AZlfgVhBemHMCrYpga0GKKfjhg+s5BX0PgZOeN3HlObKJp5vTBpD6QuKetzZfZuax+j30tUVcEmAeWUR5BNa1Dz/3eA9zXHwXBVrtNyp8B08kH0ofmgOpEO/V5g0ORU0lymnSncXktZxwRBICIe/fWTHIbnlg1awGBr3jExZTTLKIBnjdhoVixOpHD1dopY1b5oHcK2bRnhq/tZ9el+iAogkk9o4J/om74duXCP4Mg4qO3vf8sjFewO1izEU4xOCbCiQwhWgxsHXZOEwlkPVosMMAEuY1aAjgR8X6gaWDLerDtiNsFELZzu05hn7n321f5yyJOSFVpO0yspw5asJLEM0ROlr4v/eH8IKaRl4n/ZoG6W6mSqUOxGO41FBvXJpow1fcpK7H2n3Cd2BK7qyjlADbGRpfcAiLx8=
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBERNETES_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
