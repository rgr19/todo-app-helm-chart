dist: trusty
sudo: false
before_install:
- wget https://get.helm.sh/helm-$HELM_VERSION-linux-amd64.tar.gz
- tar xzvf helm-$HELM_VERSION-linux-amd64.tar.gz
- mv linux-amd64/helm helm
- chmod u+x helm
- wget https://github.com/garethr/kubeval/releases/download/0.10.0/kubeval-linux-amd64.tar.gz
- tar xzvf kubeval-linux-amd64.tar.gz
- chmod u+x kubeval
- mv helm kubeval /home/travis/bin/
- helm init -c
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBECTL_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: cmaZy99dZHX5dY5Rb6nDRJcngImDK/kltqVFPRTmZdtFCWv7qvSgv/lvqp+qr13ZmuWwbvZ8LlDpcBUvuIIsHyPcYaB56p9CnB2Qs9kpA5COyCUgIpJY+xiusGfHbKfcUJAPkrLKI9Qcamle84fOkKOCwgPeQ299I4CQF5Th2xSXxW8WN2r2OwZ+QuTyej7SUSIzDF7IWHwUkM1ZmPlsYP5M7Z8UVvR3OSLizeJtPpR1BeHuszKgNSutTLAz7Gs/1ePj8qlil1xrEpVSjp88duq/9ORzyyKyWwqKAGhFJ9Hy6SqLy1upMBs8UXg4kzXBEaPFefV8pSHGUsx2iiRnj+4wRVZ8c7JjHb53a1wPqxF4w67hfoYmyFDCOK9projYXFk25H40g8xrCXzSfE1hyQWh2oe3Afg/wQCKp30KSS90VzDQTM+aFNBaGwlYkvDfA3kC11yfNYpLj3IPBaFwPTU1UqWcBb/SM+0Pv7qkK6hDF4ml/Dt+EV81Ug5V813WaAcSPwu6rlLQgCbCjtCj8iSKSYd+y9c/zuHXuU55zftf0sUJjv+684jaJQB5UeRsh9ljTs77ZpIZ9MV3Wp56R3DVe0tSJnvPMR8i1C3xUtTmJim13/9uSQ9UpPzVMsR/8omyz9tKi+Q5RKJum/jStC37rYmoHzAjmUhKxE2IiLU=
