dist: xenial
before_install:
- bash install/helm_kubeval_install.sh
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- bash scripts/kubeval_validate_manifest.sh
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: pk1djVmypbBNg5ly1Pd6MKumwIs8wmyyXsc+U759DbJ4DtBcMduE2TZ/afVRVNLKYQR8NDuYL3etwVcWjA3qP5HKVkcKP3VLDd7YTZmsdHETfQvDPeYhb3GH2YG/32OsPgd46jiu9YDDFmiT7wpGN0WBmImdk0tCsXxVoySUZaL3TNcyZfpt2S2UUIyCixJtMUHo4cH1Pxzl1EvMGKtB5jImWvWtmZ5NR/gq6W7GLMvYBJ1MK1uucIyDK20WFVt3W9MokE0/rJwjFnBPNXjox1sBFXeZK2RUrIjTTu1GqX6VAr+zB5P6gdoM/GRNjzTIHNOJ8kvG3Gcs1BFeYOH55yLH6D40SWU6QTzwsREoYCXicIQhLfgA1ZA60+nUaLZ13IBZxdIqT944E4i7IYDCxDSHf7yAlAdkKNyBvDUHKepGIVmB5n9SB37c3vO9ulRKcE9NNHuupWFHtbYcqyBe4EoKfks9nodRsUjiz0HDF6X0GwrIijJifxh2Fh+DpqrtSOBAcnJfzIDpDYGqqYZbgK1H5uLQh5qnHxO7ox/A1Z/J5VRFZEuKNoNfhlT/UL4LPBJmzcbag+fDCLuE0nV28huWnFkXRh09Cg1XAyoD2R7lCkJFf6cq0Yw1vCVSKbjlx31NL/4hN1zW9C3yowSij1uwxz3RaJg4dpUYBCAZI+U=
