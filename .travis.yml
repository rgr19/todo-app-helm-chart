dist: xenial
before_install:
- bash install/helm_kubeval_install.sh
script:
- helm lint charts/todo-app
- mkdir manifests
- helm template charts/todo-app --output-dir manifests
- find manifests/ -name '*.yaml' | grep -v crd | xargs kubeval -v $KUBECTL_VERSION
after_success:
- mkdir distribution
- helm package charts/todo-app --destination distribution/
- helm repo index --url $GITHUB_PAGES_URL/todo-app-helm-chart ./distribution/
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  local_dir: "./distribution"
  on:
    branch: master
env:
  global:
    secure: VCYKaDqfI+Wb1j/6kN1MAO+KAWXM7A5SkHbtiiKiRhKslzOrz2MlV9BT0sudPX4t/M0jaDMJckmFwc4AG0eiY1Ymr/1LgH08j0E3mBBQmFldk6/gshkp3IUB1bmuYeqq7KNm72t2BPyQiQMi81iQCThJCNWo+cO6i/dB3dYti8pCzzOPYc/Rqs2MLCjTJYgDF822mPx0jTEbviaCNWXYJTYsE4AKMGcGTlivLW/Ers/wgEQSp4yiQUnMJYCIV3ya7eZ4n8r+fSSxf9n1iDrf4YRkTDxbsKODgSiw3aHGldZodmI7jGE5rZ4GwlmFDKvmYnMq4eUyCKmv1PXl4FQhKWzLL2QNV4vXxndESyLZhWeN2UTlfHkxSI0ryRwoWoygcY3gP+Q+xnuyWNXln3A/SPFYSUssbE3HSlxKrLzbIrC2EsW7+6QkNAHNMcRh6FG+3Llrdw65sOCjXqiiuhsdvfwoTIRsLOykw4Hx90TARYzVtCtx+kkcEPNEZJHnZnx5WHR4yzjrdZQl5DI6VEhW/UPE6ZbFdMfcYbGDlpHK0nRWe3wWbqnEmei4677ez5fjviEZXg+Tc1H+n7fSoFpKFURbNQTt1+opBt+FhqoEoDTm1jG/NejFeeXzd9UJPhtXGu83bmXBOsn7TQbIubSt5tsSItjUBrxiet3ZgTl2FwY=
